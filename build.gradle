import java.text.SimpleDateFormat

plugins {
  id 'groovy'
  id 'java-library'
  id "io.morethan.jmhreport" version "0.9.0"
  id "idea"
}


apply from: 'jmh.gradle'

group 'net.jnellis'
version '1.0-SNAPSHOT'

repositories {
  mavenCentral()
}

compileJava {
  options.compilerArgs = ["-Xlint:unchecked",
                          "-Xlint:preview",
                          "-Xdiags:verbose",
                          "-Xlint:deprecation"]

  options.release = 8
}

idea {
  module {
    downloadJavadoc = true     
  }
}

test{
  useJUnitPlatform()
}

dependencies {
  implementation 'org.apache.commons:commons-collections4:4.4'
  implementation 'org.codehaus.groovy:groovy-all:3.0.10'
  testImplementation 'org.junit.jupiter:junit-jupiter-api:5.8.2'
  testImplementation 'org.junit.jupiter:junit-jupiter-params:5.8.2'
  testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.8.2'

  testImplementation platform("org.spockframework:spock-bom:2.1-groovy-3.0")
  testImplementation "org.spockframework:spock-core"
 
}

// jmhReport setting
def reportFile = file("$projectDir/docs/jmh/report.json")

jmh {
  include = ["InPlace.*ArrayInterleaveBench" ]
  iterations = 10
  warmupIterations = 5
  jmhVersion = '1.35'
  benchmarkMode = ['avgt']
  resultFormat = 'JSON'
  resultsFile = reportFile
//  profilers=['stack']
  fork = 2
  timeUnit = 'ns'
  timeOnIteration = '1s'
  warmup = '1s'
  includeTests = false
//  jvmArgs = ['-Djmh.separateClasspathJAR']
//  benchmarkParameters = ['maxPieceSize':[20,50,100],'BINS':[50,100]]

//  verbosity = 'EXTRA'
//  help = true  // uncomment for jmh CLI help screen, then exit
//  list = true  // uncomment to list benchmarks that match filter, and exit
//  listp = true // uncomment to list benchmarks that match filter along with
  // their parameter list, then exit
//  lprof = true // uncomment to list available profilers, then exit
//  lrf = true   // uncomment to list available result formats, then exit
}

jmhReport {
  def dateStr = new SimpleDateFormat("yy_MM_dd/HH_mm").format(new Date())
  jmhResultPath = reportFile
  jmhReportOutput =   file("$projectDir/docs/jmh/$dateStr")
}
tasks.jmhReport.doFirst{ mkdir(jmhReport.jmhReportOutput) }

tasks.jmh.finalizedBy tasks.jmhReport
